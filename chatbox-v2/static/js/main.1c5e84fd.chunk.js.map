{"version":3,"sources":["Utils.ts","ClientId.ts","Badges.tsx","Content.tsx","Pronouns.tsx","Message.tsx","Color.js","Chat.tsx","App.tsx","Configurator.tsx","index.tsx","ColorAdjustmentMode.ts","Constants.tsx"],"names":["fetchTwitch","path","a","fetch","headers","response","json","fetchJSON","createSrcSet","urls","map","str","i","join","Badges","props","configContext","useContext","ConfigContext","badgeContext","BadgesContext","showBadges","badges","badgeElements","split","badge","badgeData","get","push","className","alt","srcSet","src","Content","text","rawEmotes","emotes","isMe","test","replace","trim","emote","emoteId","indicies","start","end","id","Math","max","min","length","channelEmotes","EmotesContext","idx","nextIdx","indexOf","name","slice","sort","x","y","index","content","key","substr","elements","item","Pronouns","pronounsContext","PronounsContext","showPronouns","display","pronouns","userMap","nick","displayMap","pronoun","fetchPronouns","Message","config","DefaultConfig","adjuster","ColorContext","message","rawNick","prefix","blockedUsers","includes","toLowerCase","hideCommands","params","startsWith","tags","color","showUserColours","process","TwitchDefaultColors","charCodeAt","style","hue2rgb","p","q","t","bit2linear","channel","pow","linear2bit","Color","protanope","deuteranope","tritanope","RGBAColor","RGBA","r","g","b","this","HSVAColor","HSVA","h","s","v","HSLAColor","HSLA","l","XYZAColor","XYZA","z","LUVAColor","LUVA","u","prototype","eq","rgb","fromName","context","_context","canvas","_canvas","document","createElement","getContext","clearRect","fillStyle","fillRect","data","getImageData","fromCSS","charAt","fromHex","match","exec","parseInt","parseFloat","code","alpha","Error","raw","fromHSVA","floor","f","round","undefined","fromXYZA","R","G","B","fromHSLA","toRGBA","toHSVA","fromRGBA","toHSLA","toCSS","toXYZA","toLUVA","toHex","toString","get_Y","luminance","brighten","amount","daltonize","type","cvd","CVDMatrix","hasOwnProperty","cvd_a","cvd_b","cvd_c","cvd_d","cvd_e","cvd_f","cvd_g","cvd_h","cvd_i","L","M","S","m","RR","GG","BB","_r","_g","_b","_a","hsl","d","targetLuminance","target","mid","_h","_s","_l","hsv","_v","xyz","fromLUVA","deltaGammaFactor","WHITE","uDeltaGamma","vDeltagamma","Y","KAPPA","X","_x","_y","_z","EPSILON","luv","Z","yGamma","deltaDivider","deltaFactor","uDelta","vDelta","_u","ColorAdjuster","base","mode","contrast","_contrast","_base","_mode","rebuildContrast","val","_dark","_cache","Map","lum","_luv","_luma","throw_errors","has","err","luma","out","set","React","createContext","Chat","state","connected","messages","pronounUsers","pronounDisplay","colorAdjuster","load","previousProps","channelName","readableColours","readableContrast","readableBackground","readableMode","setState","errorMessage","webSocket","close","users","channelId","_id","socket","WebSocket","addEventListener","onSocketOpen","bind","onSocketClose","onSocketMessage","encodedId","encodeURIComponent","Promise","all","loadBadges","loadEmotes","loadPronouns","badgeSets","badgeName","badgeSet","badge_sets","badgeVersion","versions","image_url_1x","image_url_2x","image_url_4x","console","log","bttvEmotes","emoteSet","Array","isArray","concat","sharedEmotes","images","e","pronounsJson","value","userName","pending","pronoun_id","ev","sendIrc","random","ircMessage","parse","command","oldState","send","fontColor","fill","fontFamily","fontName","fontSize","fontWeight","filter","webkitTextStroke","stroke","strokeWidth","dropShadow","dropShadowOffset","dropShadowBlur","dropShadowColour","outline","outlineThickness","outlineColour","height","viewBox","width","xmlns","xmlnsXlink","Provider","Component","App","newConfig","decode","Buffer","from","window","location","hash","substring","Object","assign","Checkbox","checked","onChange","label","Configurator","chatConfig","newValue","preventDefault","configDiff","element","configString","btoa","String","fromCharCode","MsgPack","onSubmit","href","placeholder","onChannelNameChange","onBlur","updateChat","size","flex","onValueChange","isNaN","margin","step","readOnly","ReactDOM","render","getElementById","ColorAdjustmentMode","hslLuma"],"mappings":"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","file":"static/js/main.1c5e84fd.chunk.js","sourcesContent":["import { ClientId } from \"./ClientId\";\r\n\r\nexport const fetchTwitch = async (path: string) => {\r\n  let response = await fetch(path, { headers: { \"Client-ID\": ClientId } });\r\n  return await response.json();\r\n}\r\n\r\nexport const fetchJSON = async (path: string) => {\r\n  let response = await fetch(path);\r\n  return await response.json();\r\n}\r\n\r\nexport const createSrcSet = (urls: string[]) =>\r\n  urls.map((str, i) => i === 0 ? `${str} ` : `${str} ${i + 1}x`).join(', ');\r\n","export const ClientId = 'gp762nuuoqcoxypju8c569th9wz7q5';","import { BadgesContext, ConfigContext } from \"./Chat\";\r\nimport React, { useContext } from 'react';\r\nimport { createSrcSet } from \"./Utils\";\r\n\r\ninterface BadgesProps {\r\n  badges?: string\r\n}\r\n\r\nexport const Badges = (props: BadgesProps) => {\r\n  const configContext = useContext(ConfigContext);\r\n  const badgeContext = useContext(BadgesContext);\r\n\r\n  if(!configContext?.showBadges) return null;\r\n\r\n  let badges = props.badges ?? \"\";\r\n  let badgeElements: Array<any> = [];\r\n  for (const badge of badges.split(',')) {\r\n    let badgeData = badgeContext.get(badge);\r\n    if (!badgeData) continue;\r\n\r\n    badgeElements.push(<img className=\"badge\" alt={\"\"} key={badge} srcSet={createSrcSet(badgeData)} src={badgeData[0]} />)\r\n  }\r\n\r\n  return (\r\n    <>{badgeElements}</>\r\n  )\r\n}","import React, { useContext } from 'react';\r\nimport { EmotesContext } from './Chat';\r\nimport { Emote, TwitchEmote } from './Types';\r\nimport { createSrcSet } from './Utils';\r\n\r\ninterface ContentProps {\r\n  text: string;\r\n  emotes: string;\r\n}\r\n\r\n\r\nexport const Content = (props: ContentProps) => {\r\n  let text = props.text;\r\n  let rawEmotes = props.emotes ?? \"\"\r\n\r\n  // this has to be done before you parse emotes\r\n  let isMe = false;\r\n  if (/^\\x01ACTION.*\\x01$/.test(text)) {\r\n    isMe = true;\r\n    text = text.replace(/^\\x01ACTION/, '').replace(/\\x01$/, '').trim();\r\n  }\r\n\r\n  // emotes appear as <emoteid>:<start>-<end>,<start>-<end>/ (e.g. 302347771:16-26,33-43)\r\n  let emotes: Array<TwitchEmote> = [];\r\n  for (const emote of rawEmotes.split('/')) {\r\n    if (!emote) continue;\r\n\r\n    const [emoteId, indicies] = emote.split(':');\r\n    for (const indexSet of indicies.split(',')) {\r\n      const [start, end] = indexSet.split('-');\r\n      emotes.push({\r\n        id: emoteId,\r\n        urls: [\r\n          `https://static-cdn.jtvnw.net/emoticons/v2/${emoteId}/default/dark/1.0`,\r\n          `https://static-cdn.jtvnw.net/emoticons/v2/${emoteId}/default/dark/2.0`,\r\n          `https://static-cdn.jtvnw.net/emoticons/v2/${emoteId}/default/dark/3.0`,\r\n        ],\r\n        start: Math.max(+start, 0),\r\n        end: Math.min(+end + 1, text.length)\r\n      });\r\n    }\r\n  }\r\n\r\n  let channelEmotes = useContext(EmotesContext);\r\n  let idx = -1;\r\n  let nextIdx = 0;\r\n  do {\r\n    nextIdx = text.indexOf(' ', idx + 1);\r\n    if (nextIdx === -1) {\r\n      nextIdx = text.length;\r\n    }\r\n\r\n    let name = text.slice(idx + 1, nextIdx);\r\n    let emote = channelEmotes.get(name);\r\n    if (emote) {      \r\n      emotes.push({\r\n        id: name,\r\n        urls: emote,\r\n        start: Math.max(idx + 1, 0),\r\n        end: Math.min(nextIdx, text.length)\r\n      });\r\n    }\r\n  } while ((idx = text.indexOf(' ', nextIdx)) !== -1);\r\n\r\n  emotes.sort((x, y) => x.start - y.start);\r\n\r\n  let index = 0;\r\n  let content: Array<string | Emote> = [];\r\n  for (const emote of emotes) {\r\n    content.push(text.slice(index, emote.start));\r\n    content.push({\r\n      id: emote.id,\r\n      urls: emote.urls,\r\n      key: `${emote.start}-${emote.end}`\r\n    });\r\n    index = emote.end;\r\n  }\r\n\r\n  content.push(text.substr(index, text.length - index));  \r\n\r\n  let elements: Array<any> = [];\r\n  for (const item of content) {\r\n    if (typeof item === 'string') {\r\n      elements.push(item);\r\n      continue;\r\n    }\r\n\r\n    let emote = item as Emote;\r\n    elements.push(<img className=\"emote\" key={item.key} alt={item.id} srcSet={createSrcSet(emote.urls)} src={emote.urls[0]} />);\r\n  }\r\n\r\n  return (\r\n    <span className={\"message-content \" + (isMe ? \"me\" : \"\")}>{elements}</span>\r\n  );\r\n}","import React, { useContext } from 'react';\r\nimport { ConfigContext, PronounsContext } from './Chat';\r\n\r\ninterface PronounsProps {\r\n    nick: string;\r\n}\r\n\r\nexport const Pronouns = (props: PronounsProps) => {\r\n    const configContext = useContext(ConfigContext);\r\n    const pronounsContext = useContext(PronounsContext);\r\n    if(!configContext?.showPronouns) return null;\r\n\r\n    let display = \"\";\r\n    let pronouns = pronounsContext?.userMap.get(props.nick);\r\n    if (!pronouns) pronounsContext?.fetchPronouns(props.nick);\r\n    else {\r\n        display = pronounsContext?.displayMap.get(pronouns.pronoun) ?? \"\";\r\n    }\r\n\r\n    return (display ? <span className=\"pronouns\">{display}</span> : null);\r\n}\r\n","import React, { useContext } from 'react';\r\nimport { IRCMessage } from \"irc-message-ts\";\r\nimport { DefaultConfig, TwitchDefaultColors } from './Constants';\r\nimport { Badges } from \"./Badges\"\r\nimport { Content } from \"./Content\"\r\nimport { Pronouns } from './Pronouns';\r\nimport { ColorContext, ConfigContext } from './Chat';\r\nimport { ColorAdjuster } from './Color';\r\nimport { ColorAdjustmentMode } from \"./ColorAdjustmentMode\";\r\n\r\ninterface MessageProps {\r\n  message: IRCMessage;\r\n}\r\n\r\nexport const Message = (props: MessageProps) => {\r\n  const config = useContext(ConfigContext) ?? DefaultConfig;\r\n  const adjuster = useContext(ColorContext);\r\n\r\n  let message = props.message;\r\n  let rawNick = message.prefix?.split('@')[0].split('!')[0];\r\n\r\n  if (config?.blockedUsers.includes(rawNick!.toLowerCase())) { return null; }\r\n  if (config?.hideCommands && message.params[1].startsWith('!')) { return null; }\r\n\r\n  let nick = message.tags[\"display-name\"] ?? rawNick;\r\n  let color: string = \"inherit\";\r\n\r\n  if (config?.showUserColours) {\r\n    color = adjuster.process(!message.tags.color ? TwitchDefaultColors[nick.toLowerCase().charCodeAt(0) % 15] : message.tags.color);\r\n  }\r\n\r\n  return (\r\n    <p className=\"message\">\r\n      <Badges badges={message.tags.badges} />\r\n      <Pronouns nick={rawNick!} />\r\n      <span className=\"nick\" style={{ color }}>{nick}</span>\r\n      <Content text={message.params[1]} emotes={message.tags.emotes} />\r\n    </p>\r\n  );\r\n}","'use strict';\n\nexport function hue2rgb(p, q, t) {\n\tif ( t < 0 ) t += 1;\n\tif ( t > 1 ) t -= 1;\n\tif ( t < 1/6 )\n\t\treturn p + (q-p) * 6 * t;\n\tif ( t < 1/2 )\n\t\treturn q;\n\tif ( t < 2/3 )\n\t\treturn p + (q-p) * (2/3 - t) * 6;\n\treturn p;\n}\n\nexport function bit2linear(channel) {\n\t// http://www.brucelindbloom.com/Eqn_RGB_to_XYZ.html\n\t// This converts rgb 8bit to rgb linear, lazy because the other algorithm is really really dumb\n\t//return Math.pow(channel, 2.2);\n\n\t// CSS Colors Level 4 says 0.03928, Bruce Lindbloom who cared to write all algos says 0.04045, used bruce because whynawt\n\treturn (channel <= 0.04045) ? channel / 12.92 : Math.pow((channel + 0.055) / 1.055, 2.4);\n}\n\nexport function linear2bit(channel) {\n\t// Using lazy conversion in the other direction as well\n\t//return Math.pow(channel, 1/2.2);\n\n\t// I'm honestly not sure about 0.0031308, I've only seen it referenced on Bruce Lindbloom's site\n\treturn (channel <= 0.0031308) ? channel * 12.92 : Math.pow(1.055 * channel, 1/2.4) - 0.055;\n}\n\n\nexport const Color = {};\n\nColor._canvas = null;\nColor._context = null;\n\nColor.CVDMatrix = {\n\tprotanope: [ // reds are greatly reduced (1% men)\n\t\t0.0, 2.02344, -2.52581,\n\t\t0.0, 1.0,      0.0,\n\t\t0.0, 0.0,      1.0\n\t],\n\tdeuteranope: [ // greens are greatly reduced (1% men)\n\t\t1.0,      0.0, 0.0,\n\t\t0.494207, 0.0, 1.24827,\n\t\t0.0,      0.0, 1.0\n\t],\n\ttritanope: [ // blues are greatly reduced (0.003% population)\n\t\t1.0,       0.0,      0.0,\n\t\t0.0,       1.0,      0.0,\n\t\t-0.395913, 0.801109, 0.0\n\t]\n}\n\n\nconst RGBAColor = Color.RGBA = function(r, g, b, a) {\n\tthis.r = r||0; this.g = g||0; this.b = b||0; this.a = a||0;\n};\n\nconst HSVAColor = Color.HSVA = function(h, s, v, a) {\n\tthis.h = h||0; this.s = s||0; this.v = v||0; this.a = a||0;\n};\n\nconst HSLAColor = Color.HSLA = function(h, s, l, a) {\n\tthis.h = h||0; this.s = s||0; this.l = l||0; this.a = a||0;\n};\n\nconst XYZAColor = Color.XYZA = function(x, y, z, a) {\n\tthis.x = x||0; this.y = y||0; this.z = z||0; this.a = a||0;\n};\n\nconst LUVAColor = Color.LUVA = function(l, u, v, a) {\n\tthis.l = l||0; this.u = u||0; this.v = v||0; this.a = a||0;\n};\n\n\n// RGBA Colors\n\nRGBAColor.prototype.eq = function(rgb) {\n\treturn rgb.r === this.r && rgb.g === this.g && rgb.b === this.b && rgb.a === this.a;\n}\n\nRGBAColor.fromName = function(name) {\n\tlet context = Color._context;\n\tif ( ! context ) {\n\t\tconst canvas = Color._canvas = document.createElement('canvas');\n\t\tcontext = Color._context = canvas.getContext('2d');\n\t}\n\n\tcontext.clearRect(0,0,1,1);\n\tcontext.fillStyle = name;\n\tcontext.fillRect(0,0,1,1);\n\tconst data = context.getImageData(0,0,1,1);\n\n\tif ( ! data || ! data.data || data.data.length !== 4 )\n\t\treturn null;\n\n\treturn new RGBAColor(data.data[0], data.data[1], data.data[2], data.data[3] / 255);\n}\n\nRGBAColor.fromCSS = function(rgb) {\n\tif ( ! rgb )\n\t\treturn null;\n\n\trgb = rgb.trim();\n\n\tif ( rgb.charAt(0) === '#' )\n\t\treturn RGBAColor.fromHex(rgb);\n\n\tconst match = /rgba?\\( *(\\d+%?) *, *(\\d+%?) *, *(\\d+%?) *(?:, *([\\d.]+))?\\)/i.exec(rgb);\n\tif ( match ) {\n\t\tlet r = match[1],\n\t\t\tg = match[2],\n\t\t\tb = match[3],\n\t\t\ta = match[4];\n\n\t\tif ( r.charAt(r.length-1) === '%' )\n\t\t\tr = 255 * (parseInt(r,10) / 100);\n\t\telse\n\t\t\tr = parseInt(r,10);\n\n\t\tif ( g.charAt(g.length-1) === '%' )\n\t\t\tg = 255 * (parseInt(g,10) / 100);\n\t\telse\n\t\t\tg = parseInt(g,10);\n\n\t\tif ( b.charAt(b.length-1) === '%' )\n\t\t\tb = 255 * (parseInt(b,10) / 100);\n\t\telse\n\t\t\tb = parseInt(b,10);\n\n\t\tif ( a )\n\t\t\tif ( a.charAt(a.length-1) === '%' )\n\t\t\t\ta = parseInt(a,10) / 100;\n\t\t\telse\n\t\t\t\ta = parseFloat(a);\n\t\telse\n\t\t\ta = 1;\n\n\t\treturn new RGBAColor(\n\t\t\tMath.min(Math.max(0, r), 255),\n\t\t\tMath.min(Math.max(0, g), 255),\n\t\t\tMath.min(Math.max(0, b), 255),\n\t\t\tMath.min(Math.max(0, a), 1)\n\t\t);\n\t}\n\n\treturn RGBAColor.fromName(rgb);\n}\n\nRGBAColor.fromHex = function(code, alpha = 1) {\n\tif ( code.charAt(0) === '#' )\n\t\tcode = code.slice(1);\n\n\tif ( code.length === 3 )\n\t\tcode = `${code[0]}${code[0]}${code[1]}${code[1]}${code[2]}${code[2]}`;\n\n\telse if ( code.length === 4 )\n\t\tcode = `${code[0]}${code[0]}${code[1]}${code[1]}${code[2]}${code[2]}${code[3]}${code[3]}`;\n\n\tif ( code.length === 8 ) {\n\t\talpha = parseInt(code.slice(6), 16) / 255;\n\t\tcode = code.slice(0, 6);\n\n\t} else if ( code.length !== 6 )\n\t\tthrow new Error('invalid hex code');\n\n\tconst raw = parseInt(code, 16);\n\treturn new RGBAColor(\n\t\t(raw >> 16),\t\t // Red\n\t\t(raw >> 8 & 0x00FF), // Green\n\t\t(raw & 0x0000FF),    // Blue,\n\t\talpha                // Alpha\n\t);\n}\n\nRGBAColor.fromHSVA = function(h, s, v, a) {\n\tlet r, g, b;\n\n\tconst i = Math.floor(h * 6),\n\t\tf = h * 6 - i,\n\t\tp = v * (1 - s),\n\t\tq = v * (1 - f * s),\n\t\tt = v * (1 - (1 - f) * s);\n\n\tswitch(i % 6) {\n\t\tcase 0: r = v; g = t; b = p; break;\n\t\tcase 1: r = q; g = v; b = p; break;\n\t\tcase 2: r = p; g = v; b = t; break;\n\t\tcase 3: r = p; g = q; b = v; break;\n\t\tcase 4: r = t; g = p; b = v; break;\n\t\tcase 5: r = v; g = p; b = q;\n\t}\n\n\treturn new RGBAColor(\n\t\tMath.round(Math.min(Math.max(0, r*255), 255)),\n\t\tMath.round(Math.min(Math.max(0, g*255), 255)),\n\t\tMath.round(Math.min(Math.max(0, b*255), 255)),\n\t\ta === undefined ? 1 : a\n\t);\n}\n\nRGBAColor.fromXYZA = function(x, y, z, a) {\n\tconst R =  3.240479 * x - 1.537150 * y - 0.498535 * z,\n\t\tG = -0.969256 * x + 1.875992 * y + 0.041556 * z,\n\t\tB =  0.055648 * x - 0.204043 * y + 1.057311 * z;\n\n\t// Make sure we end up in a real color space\n\treturn new RGBAColor(\n\t\tMath.max(0, Math.min(255, 255 * linear2bit(R))),\n\t\tMath.max(0, Math.min(255, 255 * linear2bit(G))),\n\t\tMath.max(0, Math.min(255, 255 * linear2bit(B))),\n\t\ta === undefined ? 1 : a\n\t);\n}\n\nRGBAColor.fromHSLA = function(h, s, l, a) {\n\tif ( s === 0 ) {\n\t\tconst v = Math.round(Math.min(Math.max(0, 255*l), 255));\n\t\treturn new RGBAColor(v, v, v, a === undefined ? 1 : a);\n\t}\n\n\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s,\n\t\tp = 2 * l - q;\n\n\treturn new RGBAColor(\n\t\tMath.round(Math.min(Math.max(0, 255 * hue2rgb(p, q, h + 1/3)), 255)),\n\t\tMath.round(Math.min(Math.max(0, 255 * hue2rgb(p, q, h)), 255)),\n\t\tMath.round(Math.min(Math.max(0, 255 * hue2rgb(p, q, h - 1/3)), 255)),\n\t\ta === undefined ? 1 : a\n\t);\n}\n\nRGBAColor.prototype.toRGBA = function() { return this; }\nRGBAColor.prototype.toHSVA = function() { return HSVAColor.fromRGBA(this.r, this.g, this.b, this.a); }\nRGBAColor.prototype.toHSLA = function() { return HSLAColor.fromRGBA(this.r, this.g, this.b, this.a); }\nRGBAColor.prototype.toCSS = function() { return `rgb${this.a !== 1 ? 'a' : ''}(${Math.round(this.r)},${Math.round(this.g)},${Math.round(this.b)}${this.a !== 1 ? `,${this.a}` : ''})`; }\nRGBAColor.prototype.toXYZA = function() { return XYZAColor.fromRGBA(this.r, this.g, this.b, this.a); }\nRGBAColor.prototype.toLUVA = function() { return this.toXYZA().toLUVA(); }\n\nRGBAColor.prototype.toHex = function() {\n\tconst rgb = this.b | (this.g << 8) | (this.r << 16);\n\treturn `#${(0x1000000 + rgb).toString(16).slice(1)}`;\n}\n\n\nRGBAColor.prototype.get_Y = function() {\n\treturn ((0.299 * this.r) + ( 0.587 * this.g) + ( 0.114 * this.b)) / 255;\n}\n\n\nRGBAColor.prototype.luminance = function() {\n\tconst r = bit2linear(this.r / 255),\n\t\tg = bit2linear(this.g / 255),\n\t\tb = bit2linear(this.b / 255);\n\n\treturn (0.2126 * r) + (0.7152 * g) + (0.0722 * b);\n}\n\n\nRGBAColor.prototype.brighten = function(amount) {\n\tamount = typeof amount === `number` ? amount : 1;\n\tamount = Math.round(255 * (amount / 100));\n\n\treturn new RGBAColor(\n\t\tMath.max(0, Math.min(255, this.r + amount)),\n\t\tMath.max(0, Math.min(255, this.g + amount)),\n\t\tMath.max(0, Math.min(255, this.b + amount)),\n\t\tthis.a\n\t);\n}\n\n\nRGBAColor.prototype.daltonize = function(type) {\n\tlet cvd;\n\tif ( typeof type === 'string' ) {\n\t\tif ( Color.CVDMatrix.hasOwnProperty(type) )\n\t\t\tcvd = Color.CVDMatrix[type];\n\t\telse\n\t\t\tthrow new Error('Invalid CVD matrix');\n\t} else\n\t\tcvd = type;\n\n\tconst cvd_a = cvd[0], cvd_b = cvd[1], cvd_c = cvd[2],\n\t\tcvd_d = cvd[3], cvd_e = cvd[4], cvd_f = cvd[5],\n\t\tcvd_g = cvd[6], cvd_h = cvd[7], cvd_i = cvd[8];\n\n\t//let L, M, S, l, m, s, R, G, B, RR, GG, BB;\n\n\t// RGB to LMS matrix conversion\n\tconst L = (17.8824 * this.r) + (43.5161 * this.g) + (4.11935 * this.b),\n\t\tM = (3.45565 * this.r) + (27.1554 * this.g) + (3.86714 * this.b),\n\t\tS = (0.0299566 * this.r) + (0.184309 * this.g) + (1.46709 * this.b);\n\n\t// Simulate color blindness\n\tconst l = (cvd_a * L) + (cvd_b * M) + (cvd_c * S),\n\t\tm = (cvd_d * L) + (cvd_e * M) + (cvd_f * S),\n\t\ts = (cvd_g * L) + (cvd_h * M) + (cvd_i * S);\n\n\t// LMS to RGB matrix conversion\n\tlet R = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s),\n\t\tG = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s),\n\t\tB = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\n\n\t// Isolate invisible colors to color vision deficiency (calculate error matrix)\n\tR = this.r - R;\n\tG = this.g - G;\n\tB = this.b - B;\n\n\t// Shift colors towards visible spectrum (apply error modifications)\n\tconst RR = (0.0 * R) + (0.0 * G) + (0.0 * B),\n\t\tGG = (0.7 * R) + (1.0 * G) + (0.0 * B),\n\t\tBB = (0.7 * R) + (0.0 * G) + (1.0 * B);\n\n\t// Add compensation to original values\n\tR = Math.min(Math.max(0, RR + this.r), 255);\n\tG = Math.min(Math.max(0, GG + this.g), 255);\n\tB = Math.min(Math.max(0, BB + this.b), 255);\n\n\treturn new RGBAColor(R, G, B, this.a);\n}\n\nRGBAColor.prototype._r = function(r) { return new RGBAColor(r, this.g, this.b, this.a); }\nRGBAColor.prototype._g = function(g) { return new RGBAColor(this.r, g, this.b, this.a); }\nRGBAColor.prototype._b = function(b) { return new RGBAColor(this.r, this.g, b, this.a); }\nRGBAColor.prototype._a = function(a) { return new RGBAColor(this.r, this.g, this.b, a); }\n\n\n// HSL Colors\n\nHSLAColor.prototype.eq = function(hsl) {\n\treturn hsl.h === this.h && hsl.s === this.s && hsl.l === this.l && hsl.a === this.a;\n}\n\nHSLAColor.fromRGBA = function(r, g, b, a) {\n\tr /= 255; g /= 255; b /= 255;\n\n\tconst max = Math.max(r,g,b),\n\t\tmin = Math.min(r,g,b),\n\n\t\tl = Math.min(Math.max(0, (max+min) / 2), 1),\n\t\td = Math.min(Math.max(0, max - min), 1);\n\n\tlet h, s;\n\n\tif ( d === 0 )\n\t\th = s = 0;\n\telse {\n\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\tswitch(max) {\n\t\t\tcase r:\n\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\tbreak;\n\t\t\tcase g:\n\t\t\t\th = (b - r) / d + 2;\n\t\t\t\tbreak;\n\t\t\tcase b:\n\t\t\t\th = (r - g) / d + 4;\n\t\t}\n\t\th /= 6;\n\t}\n\n\treturn new HSLAColor(h, s, l, a === undefined ? 1 : a);\n}\n\nHSLAColor.prototype.targetLuminance = function (target) {\n\tlet s = this.s,\n\t\tmin = 0,\n\t\tmax = 1;\n\n\ts *= Math.pow(this.l > 0.5 ? -this.l : this.l - 1, 7) + 1;\n\n\tlet d = (max - min) / 2,\n\t\tmid = min + d;\n\n\tfor (; d > 1/65536; d /= 2, mid = min + d) {\n\t\tconst luminance = RGBAColor.fromHSLA(this.h, s, mid, 1).luminance()\n\t\tif (luminance > target) {\n\t\t\tmax = mid;\n\t\t} else {\n\t\t\tmin = mid;\n\t\t}\n\t}\n\n\treturn new HSLAColor(this.h, s, mid, this.a);\n}\n\nHSLAColor.prototype.toRGBA = function() { return RGBAColor.fromHSLA(this.h, this.s, this.l, this.a); }\nHSLAColor.prototype.toCSS = function() { return `hsl${this.a !== 1 ? 'a' : ''}(${Math.round(this.h*360)},${Math.round(this.s*100)}%,${Math.round(this.l*100)}%${this.a !== 1 ? `,${this.a}` : ''})`; }\nHSLAColor.prototype.toHSLA = function() { return this; }\nHSLAColor.prototype.toHSVA = function() { return this.toRGBA().toHSVA(); }\nHSLAColor.prototype.toXYZA = function() { return this.toRGBA().toXYZA(); }\nHSLAColor.prototype.toLUVA = function() { return this.toRGBA().toLUVA(); }\n\n\nHSLAColor.prototype._h = function(h) { return new HSLAColor(h, this.s, this.l, this.a); }\nHSLAColor.prototype._s = function(s) { return new HSLAColor(this.h, s, this.l, this.a); }\nHSLAColor.prototype._l = function(l) { return new HSLAColor(this.h, this.s, l, this.a); }\nHSLAColor.prototype._a = function(a) { return new HSLAColor(this.h, this.s, this.l, a); }\n\n\n// HSV Colors\n\nHSVAColor.prototype.eq = function(hsv) { return hsv.h === this.h && hsv.s === this.s && hsv.v === this.v && hsv.a === this.a; }\n\nHSVAColor.fromRGBA = function(r, g, b, a) {\n\tr /= 255; g /= 255; b /= 255;\n\n\tconst max = Math.max(r, g, b),\n\t\tmin = Math.min(r, g, b),\n\t\td = Math.min(Math.max(0, max - min), 1),\n\n\t\ts = max === 0 ? 0 : d / max,\n\t\tv = max;\n\n\tlet h;\n\n\tif ( d === 0 )\n\t\th = 0;\n\telse {\n\t\tswitch(max) {\n\t\t\tcase r:\n\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\tbreak;\n\t\t\tcase g:\n\t\t\t\th = (b - r) / d + 2;\n\t\t\t\tbreak;\n\t\t\tcase b:\n\t\t\t\th = (r - g) / d + 4;\n\t\t}\n\t\th /= 6;\n\t}\n\n\treturn new HSVAColor(h, s, v, a === undefined ? 1 : a);\n}\n\n\nHSVAColor.prototype.toRGBA = function() { return RGBAColor.fromHSVA(this.h, this.s, this.v, this.a); }\nHSVAColor.prototype.toHSVA = function() { return this; }\nHSVAColor.prototype.toHSLA = function() { return this.toRGBA().toHSLA(); }\nHSVAColor.prototype.toXYZA = function() { return this.toRGBA().toXYZA(); }\nHSVAColor.prototype.toLUVA = function() { return this.toRGBA().toLUVA(); }\n\n\nHSVAColor.prototype._h = function(h) { return new HSVAColor(h, this.s, this.v, this.a); }\nHSVAColor.prototype._s = function(s) { return new HSVAColor(this.h, s, this.v, this.a); }\nHSVAColor.prototype._v = function(v) { return new HSVAColor(this.h, this.s, v, this.a); }\nHSVAColor.prototype._a = function(a) { return new HSVAColor(this.h, this.s, this.v, a); }\n\n\n// XYZ Colors\n\nXYZAColor.prototype.eq = function(xyz) {  return xyz.x === this.x && xyz.y === this.y && xyz.z === this.z; }\n\nXYZAColor.fromRGBA = function(r, g, b, a) {\n\tconst R = bit2linear(r / 255),\n\t\tG = bit2linear(g / 255),\n\t\tB = bit2linear(b / 255);\n\n\treturn new XYZAColor(\n\t\t0.412453 * R + 0.357580 * G + 0.180423 * B,\n\t\t0.212671 * R + 0.715160 * G + 0.072169 * B,\n\t\t0.019334 * R + 0.119193 * G + 0.950227 * B,\n\t\ta === undefined ? 1 : a\n\t);\n}\n\nXYZAColor.fromLUVA = function(l, u, v, alpha) {\n\tconst deltaGammaFactor = 1 / (XYZAColor.WHITE.x + 15 * XYZAColor.WHITE.y + 3 * XYZAColor.WHITE.z),\n\t\tuDeltaGamma = 4 * XYZAColor.WHITE.x * deltaGammaFactor,\n\t\tvDeltagamma = 9 * XYZAColor.WHITE.y * deltaGammaFactor;\n\n\t// XYZAColor.EPSILON * XYZAColor.KAPPA = 8\n\tconst Y = (l > 8) ? Math.pow((l + 16) / 116, 3) : l / XYZAColor.KAPPA,\n\t\ta = 1/3 * (((52 * l) / (u + 13 * l * uDeltaGamma)) - 1),\n\t\tb = -5 * Y,\n\t\tc = -1/3,\n\t\td = Y * (((39 * l) / (v + 13 * l * vDeltagamma)) - 5),\n\n\t\tX = (d - b) / (a - c),\n\t\tZ = X * a + b;\n\n\treturn new XYZAColor(X, Y, Z, alpha === undefined ? 1 : alpha);\n}\n\n\nXYZAColor.prototype.toRGBA = function() { return RGBAColor.fromXYZA(this.x, this.y, this.z, this.a); }\nXYZAColor.prototype.toLUVA = function() { return LUVAColor.fromXYZA(this.x, this.y, this.z, this.a); }\nXYZAColor.prototype.toHSLA = function() { return this.toRGBA().toHSLA(); }\nXYZAColor.prototype.toHSVA = function() { return this.toRGBA().toHSVA(); }\nXYZAColor.prototype.toXYZA = function() { return this; }\n\n\nXYZAColor.prototype._x = function(x) { return new XYZAColor(x, this.y, this.z, this.a); }\nXYZAColor.prototype._y = function(y) { return new XYZAColor(this.x, y, this.z, this.a); }\nXYZAColor.prototype._z = function(z) { return new XYZAColor(this.x, this.y, z, this.a); }\nXYZAColor.prototype._a = function(a) { return new XYZAColor(this.x, this.y, this.z, a); }\n\n\n// LUV Colors\n\nXYZAColor.EPSILON = Math.pow(6 / 29, 3);\nXYZAColor.KAPPA = Math.pow(29 / 3, 3);\nXYZAColor.WHITE = (new RGBAColor(255, 255, 255, 1)).toXYZA();\n\n\nLUVAColor.prototype.eq = function(luv) { return luv.l === this.l && luv.u === this.u && luv.v === this.v; }\n\nLUVAColor.fromXYZA = function(X, Y, Z, a) {\n\tconst deltaGammaFactor = 1 / (XYZAColor.WHITE.x + 15 * XYZAColor.WHITE.y + 3 * XYZAColor.WHITE.z),\n\t\tuDeltaGamma = 4 * XYZAColor.WHITE.x * deltaGammaFactor,\n\t\tvDeltagamma = 9 * XYZAColor.WHITE.y * deltaGammaFactor,\n\n\t\tyGamma = Y / XYZAColor.WHITE.y;\n\n\tlet deltaDivider = (X + 15 * Y + 3 * Z);\n\tif (deltaDivider === 0) {\n\t\tdeltaDivider = 1;\n\t}\n\n\tconst deltaFactor = 1 / deltaDivider,\n\n\t\tuDelta = 4 * X * deltaFactor,\n\t\tvDelta = 9 * Y * deltaFactor,\n\n\t\tL = (yGamma > XYZAColor.EPSILON) ? 116 * Math.pow(yGamma, 1/3) - 16 : XYZAColor.KAPPA * yGamma,\n\t\tu = 13 * L * (uDelta - uDeltaGamma),\n\t\tv = 13 * L * (vDelta - vDeltagamma);\n\n\treturn new LUVAColor(L, u, v, a === undefined ? 1 : a);\n}\n\n\nLUVAColor.prototype.toXYZA = function() { return XYZAColor.fromLUVA(this.l, this.u, this.v, this.a); }\nLUVAColor.prototype.toRGBA = function() { return this.toXYZA().toRGBA(); }\nLUVAColor.prototype.toHSLA = function() { return this.toXYZA().toHSLA(); }\nLUVAColor.prototype.toHSVA = function() { return this.toXYZA().toHSVA(); }\nLUVAColor.prototype.toLUVA = function() { return this; }\n\n\nLUVAColor.prototype._l = function(l) { return new LUVAColor(l, this.u, this.v, this.a); }\nLUVAColor.prototype._u = function(u) { return new LUVAColor(this.l, u, this.v, this.a); }\nLUVAColor.prototype._v = function(v) { return new LUVAColor(this.l, this.u, v, this.a); }\nLUVAColor.prototype._a = function(a) { return new LUVAColor(this.l, this.u, this.v, a); }\n\n\n\nexport class ColorAdjuster {\n\tconstructor(base = '#232323', mode = 0, contrast = 4.5) {\n\t\tthis._contrast = contrast;\n\t\tthis._base = base;\n\t\tthis._mode = mode;\n\n\t\tthis.rebuildContrast();\n\t}\n\n\tget contrast() { return this._contrast }\n\tset contrast(val) { this._contrast = val; this.rebuildContrast() }\n\n\tget base() { return this._base }\n\tset base(val) { this._base = val; this.rebuildContrast() }\n\n\tget dark() { return this._dark }\n\n\tget mode() { return this._mode }\n\tset mode(val) { this._mode = val; this.rebuildContrast() }\n\n\n\trebuildContrast() {\n\t\tthis._cache = new Map;\n\n\t\tconst base = RGBAColor.fromCSS(this._base),\n\t\t\tlum = base.luminance();\n\n\t\tconst dark = this._dark = lum < 0.33;\n\n\t\tif ( dark ) {\n\t\t\tthis._luv = new XYZAColor(\n\t\t\t\t0,\n\t\t\t\t(this._contrast * (base.toXYZA().y + 0.05) - 0.05),\n\t\t\t\t0,\n\t\t\t\t1\n\t\t\t).toLUVA().l;\n\n\t\t\tthis._luma = this._contrast * (base.luminance() + 0.05) - 0.05;\n\n\t\t} else {\n\t\t\tthis._luv = new XYZAColor(\n\t\t\t\t0,\n\t\t\t\t(base.toXYZA().y + 0.05) / this._contrast - 0.05,\n\t\t\t\t0,\n\t\t\t\t1\n\t\t\t).toLUVA().l;\n\n\t\t\tthis._luma = (base.luminance() + 0.05) / this._contrast - 0.05;\n\t\t}\n\t}\n\n\tprocess(color, throw_errors = false) {\n\t\tif ( this._mode === -1 )\n\t\t\treturn '';\n\t\telse if ( this._mode === 0 )\n\t\t\treturn color;\n\n\t\tif ( color instanceof RGBAColor )\n\t\t\tcolor = color.toCSS();\n\n\t\tif ( ! color )\n\t\t\treturn null;\n\n\t\tif ( this._cache.has(color) )\n\t\t\treturn this._cache.get(color);\n\n\t\tlet rgb;\n\n\t\ttry {\n\t\t\trgb = RGBAColor.fromCSS(color);\n\t\t} catch(err) {\n\t\t\tif ( throw_errors )\n\t\t\t\tthrow err;\n\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( this._mode === 1 ) {\n\t\t\t// HSL Luma\n\t\t\tconst luma = rgb.luminance();\n\n\t\t\tif ( this._dark ? luma < this._luma : luma > this._luma )\n\t\t\t\trgb = rgb.toHSLA().targetLuminance(this._luma).toRGBA();\n\n\t\t} else if ( this._mode === 2 ) {\n\t\t\t// LUV\n\t\t\tconst luv = rgb.toLUVA();\n\t\t\tif ( this._dark ? luv.l < this._luv : luv.l > this._luv )\n\t\t\t\trgb = luv._l(this._luv).toRGBA();\n\n\t\t} else if ( this._mode === 3 ) {\n\t\t\t// HSL Loop (aka BTTV Style)\n\t\t\tif ( this._dark )\n\t\t\t\twhile ( rgb.get_Y() < 0.5 ) {\n\t\t\t\t\tconst hsl = rgb.toHSLA();\n\t\t\t\t\trgb = hsl._l(Math.min(Math.max(0, 0.1 + 0.9 * hsl.l), 1)).toRGBA();\n\t\t\t\t}\n\n\t\t\telse\n\t\t\t\twhile ( rgb.get_Y() >= 0.5 ) {\n\t\t\t\t\tconst hsl = rgb.toHSLA();\n\t\t\t\t\trgb = hsl._l(Math.min(Math.max(0, 0.9 * hsl.l), 1)).toRGBA();\n\t\t\t\t}\n\n\t\t} else if ( this._mode === 4 ) {\n\t\t\t// RGB Loop\n\t\t\tlet i = 0;\n\t\t\tif ( this._dark )\n\t\t\t\twhile ( rgb.luminance() < 0.15 && i++ < 127 )\n\t\t\t\t\trgb = rgb.brighten();\n\n\t\t\telse\n\t\t\t\twhile ( rgb.luminance() > 0.3 && i++ < 127 )\n\t\t\t\t\trgb = rgb.brighten(-1);\n\t\t}\n\n\t\tconst out = rgb.toCSS();\n\t\tthis._cache.set(color, out);\n\t\treturn out;\n\t}\n}","import React, { Component } from 'react';\nimport { parse, IRCMessage } from \"irc-message-ts\";\nimport { Message } from \"./Message\"\nimport { BTTVEmote, BTTVUser, Configuration } from \"./Types\"\nimport { fetchJSON, fetchTwitch } from \"./Utils\"\nimport './Chat.css';\nimport { ColorAdjuster } from './Color';\n\ninterface ChatState {\n  connected: boolean;\n  messages: Array<IRCMessage>\n  badges: Map<string, string[]>;\n  emotes: Map<string, string[]>;\n  colorAdjuster: ColorAdjuster;\n\n  pronounDisplay: Map<string, string>;\n  pronounUsers: Map<string, Pronoun>;\n\n  channelId?: string;\n  channelName?: string;\n  webSocket?: WebSocket;\n\n  errorMessage?: string;\n}\n\ninterface Pronoun {\n  pending: boolean;\n  pronoun: string;\n}\n\ninterface Pronouns {\n  displayMap: Map<string, string>;\n  userMap: Map<string, Pronoun>;\n  fetchPronouns: (nick: string) => void;\n}\n\nexport const ConfigContext = React.createContext<Configuration | null>(null);\nexport const ColorContext = React.createContext<ColorAdjuster>(new ColorAdjuster());\nexport const BadgesContext = React.createContext<Map<string, string[]>>(new Map());\nexport const EmotesContext = React.createContext<Map<string, string[]>>(new Map());\nexport const PronounsContext = React.createContext<Pronouns | null>(null);\n\nexport class Chat extends Component<Configuration, ChatState> {\n  constructor(props: any) {\n    super(props);\n    let state: ChatState = {\n      connected: false,\n      messages: [],\n      badges: new Map(),\n      emotes: new Map(),\n      pronounUsers: new Map(),\n      pronounDisplay: new Map(),\n      colorAdjuster: new ColorAdjuster()\n    };\n    this.state = state;\n  }\n\n  async componentDidMount() {\n    await this.load();\n  }\n\n  async componentDidUpdate(previousProps) {\n    if (this.props.channelName !== previousProps.channelName) {\n      await this.load();\n    }\n\n    if (this.props.readableColours !== previousProps.readableColours ||\n      this.props.readableContrast !== previousProps.readableContrast ||\n      this.props.readableBackground !== previousProps.readableBackground ||\n      this.props.readableMode !== previousProps.readableMode) {\n      this.setState({ colorAdjuster: new ColorAdjuster(this.props.readableBackground, (!this.props.readableColours ? 0 : this.props.readableMode), this.props.readableContrast) });\n    }\n  }\n\n  async load() {\n    this.setState({ errorMessage: undefined, messages: [], colorAdjuster: new ColorAdjuster(this.props.readableBackground, this.props.readableMode, this.props.readableContrast) });\n\n    if (!this.props.channelName) {\n      this.setState({ errorMessage: \"No channel specifed!\" });\n      return;\n    }\n\n    if (this.state.webSocket)\n      this.state.webSocket.close();\n\n    let data = await fetchTwitch(`https://api.twitch.tv/v5/users?login=${this.props.channelName}`);\n    if (!data.users?.length) {\n      this.setState({ errorMessage: \"Specified channel doesn't exist!\" });\n      return;\n    }\n\n    this.setState({ channelId: data.users[0]._id, channelName: this.props.channelName });\n\n    let socket = new WebSocket(\"wss://irc-ws.chat.twitch.tv\", 'irc');\n    socket.addEventListener(\"open\", this.onSocketOpen.bind(this));\n    socket.addEventListener(\"close\", this.onSocketClose.bind(this));\n    socket.addEventListener(\"message\", this.onSocketMessage.bind(this));\n    this.setState({ webSocket: socket });\n\n    let encodedId = encodeURIComponent(this.state.channelId!);\n    await Promise.all([this.loadBadges(encodedId), this.loadEmotes(encodedId), this.loadPronouns()]);\n  }\n\n  async loadBadges(encodedId: string) {\n    let badgeSets = await Promise.all([ // TODO: FFZ custom badges\n      fetchTwitch(`https://badges.twitch.tv/v1/badges/global/display`),\n      fetchTwitch(`https://badges.twitch.tv/v1/badges/channels/${encodedId}/display`)\n    ]);\n\n    let badges = new Map<string, string[]>();\n    for (const badgeSet of badgeSets) {\n      let set = badgeSet.badge_sets;\n      for (const badgeName in set) {\n        for (const badgeVersion in set[badgeName].versions) {\n          badges.set(`${badgeName}/${badgeVersion}`, [\n            set[badgeName].versions[badgeVersion].image_url_1x,\n            set[badgeName].versions[badgeVersion].image_url_2x,\n            set[badgeName].versions[badgeVersion].image_url_4x,\n          ]);\n        }\n      }\n    }\n\n    console.log(\"Loaded badges\", badges);\n    this.setState({ badges });\n  }\n\n  async loadEmotes(encodedId: string) {\n    let emotes = new Map<string, string[]>();\n    let bttvEmotes: Array<Array<BTTVEmote> | BTTVUser> = await Promise.all([\n      fetchJSON('https://api.betterttv.net/3/cached/frankerfacez/emotes/global'),\n      fetchJSON(`https://api.betterttv.net/3/cached/frankerfacez/users/twitch/${encodedId}`),\n      fetchJSON('https://api.betterttv.net/3/cached/emotes/global'),\n      fetchJSON(`https://api.betterttv.net/3/cached/users/twitch/${encodedId}`),\n      fetchJSON('https://api.7tv.app/v2/emotes/global'),\n      fetchJSON(`https://api.7tv.app/v2/users/${encodedId}/emotes`),\n    ]);\n\n    for (let emoteSet of bttvEmotes) {\n      if (!Array.isArray(emoteSet)) {\n        if (emoteSet.channelEmotes) {\n          emoteSet = emoteSet.channelEmotes.concat(emoteSet.sharedEmotes);\n        }\n      }\n\n      if (!Array.isArray(emoteSet)) continue;\n\n      for (const emote of emoteSet as Array<BTTVEmote>) {\n        if (emote.images) {\n          emotes.set(emote.code, [emote.images['1x'], emote.images['2x'], emote.images['4x']]);\n          continue;\n        }\n\n        if (emote.code) {\n          emotes.set(emote.code, [\n            `https://cdn.betterttv.net/emote/${emote.id}/1x`,\n            `https://cdn.betterttv.net/emote/${emote.id}/2x`,\n            `https://cdn.betterttv.net/emote/${emote.id}/3x`\n          ]);\n\n          continue;\n        }\n\n        if (emote.urls) {\n          emotes.set(emote.name!, emote.urls.map(e => e[1]));\n          continue;\n        }\n      }\n    }\n\n    console.log(\"Loaded emotes\", emotes);\n    this.setState({ emotes });\n  }\n\n  async loadPronouns() {\n    let pronouns = new Map<string, string>();\n    let pronounsJson = await fetchJSON(\"https://pronouns.alejo.io/api/pronouns\");\n    for (const value of pronounsJson) {\n      pronouns.set(value.name, value.display);\n    }\n\n    this.setState({ pronounDisplay: pronouns });\n  }\n\n  async fetchPronouns(userName: string) {\n    if (this.state.pronounUsers.has(userName)) return;\n    this.state.pronounUsers.set(userName, { pending: true, pronoun: \"\" });\n\n    let json = await fetchJSON(`https://pronouns.alejo.io/api/users/${userName}`);\n    if (!Array.isArray(json)) return;\n\n    this.state.pronounUsers.set(userName, { pending: false, pronoun: json[0]?.pronoun_id });\n    this.setState({ pronounUsers: this.state.pronounUsers });\n  }\n\n  onSocketOpen(ev: Event) {\n    this.sendIrc(`PASS ass`);\n    this.sendIrc(`NICK justinfan${Math.floor(Math.random() * 65536)}`);\n    this.sendIrc(`CAP REQ :twitch.tv/commands twitch.tv/tags`);\n    this.sendIrc(`JOIN #${this.props.channelName}`);\n  }\n\n  onSocketClose(ev: Event) {\n\n  }\n\n  onSocketMessage(ev: MessageEvent<string>) {\n    for (const message of ev.data.split('\\r\\n')) {\n      if (!message) continue;\n      let ircMessage = parse(message)!;\n      if (ircMessage === null) continue;\n\n      let command = ircMessage.command?.toLowerCase();\n      if (!command) continue;\n\n      switch (command) {\n        case \"ping\":\n          this.sendIrc(`PONG ${ircMessage.params[0]}`);\n          continue;\n        // case \"clearchat\":\n        //   this.setState({ messages: [] });\n        //   continue;\n        case \"privmsg\":\n          this.setState(oldState => ({ messages: [...(oldState.messages.length >= 50 ? oldState.messages.slice(1, 50) : oldState.messages), ircMessage] }));\n          continue;\n      }\n    }\n  }\n\n  sendIrc(message: string) {\n    if (this.state.webSocket === undefined) throw new Error(\"what the fuck lol\");\n    this.state.webSocket.send(message + '\\r\\n');\n  }\n\n  render() {\n    let style = {\n      color: this.props.fontColor ?? \"white\",\n      fill: this.props.fontColor ?? \"white\",\n      fontFamily: this.props.fontName,\n      fontSize: this.props.fontSize + \"pt\",\n      fontWeight: this.props.fontWeight,\n      filter: \"\",\n      webkitTextStroke: \"\",\n      stroke: \"\",\n      strokeWidth: \"\",\n    }\n\n    if (this.props.dropShadow) {\n      style.filter = style.filter + `drop-shadow(${this.props.dropShadowOffset}px ${this.props.dropShadowOffset}px ${this.props.dropShadowBlur}px ${this.props.dropShadowColour})`\n    }\n\n    if (this.props.outline) {\n      style.webkitTextStroke = `${this.props.outlineThickness}px ${this.props.outlineColour}`\n      style.stroke = this.props.outlineColour!\n      style.strokeWidth = `${this.props.outlineThickness! * 7.5}px`\n    }\n\n    if (this.state.errorMessage) {\n      return (\n        <div className=\"chat-container\" style={style}>\n          <div className=\"chat-error\">\n            <svg height=\"128px\" viewBox=\"0 0 960 960\" width=\"128px\" xmlns=\"http://www.w3.org/2000/svg\" xmlnsXlink=\"http://www.w3.org/1999/xlink\">\n              <path d=\"M0,480C0,435.667 5.66667,393.083 17,352.25C28.3333,311.417 44.4167,273.167 65.25,237.5C86.0833,201.833 111.083,169.417 140.25,140.25C169.417,111.083 201.833,86.0834 237.5,65.25C273.167,44.4167 311.417,28.3334 352.25,17C393.083,5.66669 435.667,0 480,0C524,0 566.417,5.75 607.25,17.25C648.083,28.75 686.333,44.9167 722,65.75C757.667,86.5834 790.083,111.583 819.25,140.75C848.417,169.917 873.417,202.333 894.25,238C915.083,273.667 931.25,311.917 942.75,352.75C954.25,393.583 960,436 960,480C960,524.333 954.333,566.917 943,607.75C931.667,648.583 915.583,686.833 894.75,722.5C873.917,758.167 848.917,790.583 819.75,819.75C790.583,848.917 758.167,873.917 722.5,894.75C686.833,915.583 648.583,931.667 607.75,943C566.917,954.333 524.333,960 480,960C435.667,960 393,954.333 352,943C311,931.667 272.75,915.583 237.25,894.75C201.75,873.917 169.417,848.917 140.25,819.75C111.083,790.583 86.0833,758.25 65.25,722.75C44.4167,687.25 28.3333,649 17,608C5.66667,567 0,524.333 0,480ZM896,480C896,441.667 891.083,404.75 881.25,369.25C871.417,333.75 857.417,300.583 839.25,269.75C821.083,238.917 799.417,210.917 774.25,185.75C749.083,160.583 721.083,138.917 690.25,120.75C659.417,102.583 626.25,88.5834 590.75,78.75C555.25,68.9167 518.333,64.0001 480,64C441.667,64.0001 404.75,68.9167 369.25,78.75C333.75,88.5834 300.583,102.5 269.75,120.5C238.917,138.5 210.833,160.167 185.5,185.5C160.167,210.833 138.5,238.917 120.5,269.75C102.5,300.583 88.5833,333.75 78.75,369.25C68.9167,404.75 64,441.667 64,480C64,518.333 68.9167,555.25 78.75,590.75C88.5833,626.25 102.5,659.417 120.5,690.25C138.5,721.083 160.167,749.167 185.5,774.5C210.833,799.833 238.917,821.5 269.75,839.5C300.583,857.5 333.75,871.417 369.25,881.25C404.75,891.083 441.667,896 480,896C518.333,896 555.25,891.083 590.75,881.25C626.25,871.417 659.417,857.417 690.25,839.25C721.083,821.083 749.083,799.417 774.25,774.25C799.417,749.083 821.083,721.083 839.25,690.25C857.417,659.417 871.417,626.25 881.25,590.75C891.083,555.25 896,518.333 896,480ZM448,544L448,288C448,279.333 451.167,271.833 457.5,265.5C463.833,259.167 471.333,256 480,256C488.667,256 496.167,259.167 502.5,265.5C508.833,271.833 512,279.333 512,288L512,544C512,552.667 508.833,560.167 502.5,566.5C496.167,572.833 488.667,576 480,576C471.333,576 463.833,572.833 457.5,566.5C451.167,560.167 448,552.667 448,544ZM432,672C432,658.667 436.667,647.333 446,638C455.333,628.667 466.667,624 480,624C493.333,624 504.667,628.667 514,638C523.333,647.333 528,658.667 528,672C528,685.333 523.333,696.667 514,706C504.667,715.333 493.333,720 480,720C466.667,720 455.333,715.333 446,706C436.667,696.667 432,685.333 432,672Z\" />\n            </svg>\n            <p>{this.state.errorMessage}</p>\n          </div>\n        </div>\n      )\n    }\n    return (\n      <div className=\"chat-container\">\n        <div className=\"chat-root\" style={style}>\n          <ConfigContext.Provider value={this.props}>\n            <ColorContext.Provider value={this.state.colorAdjuster}>\n              <BadgesContext.Provider value={this.state.badges}>\n                <EmotesContext.Provider value={this.state.emotes}>\n                  <PronounsContext.Provider value={{ userMap: this.state.pronounUsers, displayMap: this.state.pronounDisplay, fetchPronouns: this.fetchPronouns.bind(this) }}>\n                    {this.state.messages.map(m => <Message key={m.tags.id} message={m} />)}\n                  </PronounsContext.Provider>\n                </EmotesContext.Provider>\n              </BadgesContext.Provider>\n            </ColorContext.Provider>\n          </ConfigContext.Provider>\n        </div>\n      </div>\n    )\n  }\n}","\r\nimport React from \"react\";\r\nimport { Chat } from \"./Chat\";\r\nimport { Configurator } from \"./Configurator\";\r\nimport { Configuration } from \"./Types\";\r\nimport { decode } from \"@msgpack/msgpack\"\r\nimport { DefaultConfig } from \"./Constants\";\r\n\r\nexport const App = () => {\r\n  let config: Configuration = DefaultConfig;\r\n  try {\r\n    let newConfig = decode(Buffer.from(window.location.hash.substring(1), 'base64')) as Partial<Configuration>;\r\n\r\n    console.log(config, newConfig);\r\n\r\n    config = Object.assign(config, newConfig);\r\n  }\r\n  catch (e) { }\r\n\r\n  return (\r\n    !!config.channelName ? <Chat {...config as Configuration} /> : <Configurator />\r\n  );\r\n};","import React, { ChangeEvent, Component } from 'react';\r\nimport { Chat } from './Chat';\r\nimport { Configuration } from './Types';\r\nimport * as MsgPack from \"@msgpack/msgpack\"\r\nimport \"./config.css\"\r\nimport { DefaultConfig } from './Constants';\r\n\r\ninterface ConfiguratorState {\r\n  config: Configuration;\r\n  chatConfig?: Configuration;\r\n}\r\n\r\n\r\nconst Checkbox = (props: { label: string, value: boolean, onChange: (event: ChangeEvent<HTMLInputElement>) => void }) => {\r\n  return (\r\n    <label className=\"checkbox\">\r\n      <input type=\"checkbox\"\r\n        checked={props.value}\r\n        onChange={props.onChange} />\r\n      <span className=\"checkmark\"></span> {props.label}\r\n    </label>\r\n  )\r\n}\r\n\r\n\r\nexport class Configurator extends Component<{}, ConfiguratorState> {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { config: DefaultConfig, chatConfig: DefaultConfig };\r\n  }\r\n\r\n  updateChat() {\r\n    this.setState({ chatConfig: this.state.config });\r\n  }\r\n\r\n  onChannelNameChange(e) {\r\n    this.setState({ config: { ...this.state.config, channelName: e.target.value } });\r\n  }\r\n\r\n  onValueChange<T>(name: string, newValue: T) {\r\n    this.setState({ config: { ...this.state.config, [name]: newValue }, chatConfig: { ...this.state.config, [name]: newValue } });\r\n  }\r\n\r\n  onSubmit(e) {\r\n    e.preventDefault();\r\n  }\r\n\r\n  render() {\r\n    let configDiff = {};\r\n    for (const key in this.state.config) {\r\n      const element = this.state.config[key];\r\n      const element2 = DefaultConfig[key];\r\n      if (element !== element2) {\r\n        configDiff[key] = element;\r\n      }\r\n    }\r\n\r\n    let configString = btoa(String.fromCharCode(...MsgPack.encode(configDiff)));\r\n\r\n    return (\r\n      <div className=\"config-root\">\r\n        <div className=\"config-pane\">\r\n          <div className=\"config-main\">\r\n            <form onSubmit={this.onSubmit.bind(this)} className=\"config-input\">\r\n              <h1>Wam's Chat Thing</h1>\r\n\r\n              <h4>A simple, easy to use chat box that supports <a href=\"https://betterttv.net/\">BetterTTV</a>,&nbsp;\r\n                <a href=\"https://frankerfacez.com/\">FrankerFaceZ</a> and&nbsp;\r\n                <a href=\"https://7tv.app/\">7tv</a> emotes!</h4>\r\n\r\n              <div className=\"config-warning\">\r\n                <p>This chat box is not yet finished, and links may break in future! Please don't use it in your layouts yet.</p>\r\n              </div>\r\n\r\n              <label className=\"form-group-label\">\r\n                Channel Name\r\n              </label>\r\n              <div className=\"form-group\">\r\n                <input type=\"text\"\r\n                  className=\"config-input-text\"\r\n                  placeholder=\"wamwoowam\"\r\n                  value={this.state.config.channelName}\r\n                  onChange={this.onChannelNameChange.bind(this)}\r\n                  onBlur={this.updateChat.bind(this)} />\r\n              </div>\r\n\r\n              <label className=\"form-group-label\">Font</label>\r\n              <div className=\"form-group\">\r\n                <input type=\"text\"\r\n                  className=\"config-input-text\"\r\n                  placeholder=\"Font Name\"\r\n                  size={1}\r\n                  style={{ flex: 3 }}\r\n                  value={this.state.config.fontName}\r\n                  onChange={(e) => this.onValueChange(\"fontName\", e.target.value)} />\r\n\r\n                <input type=\"text\"\r\n                  className=\"config-input-text\"\r\n                  placeholder=\"Font Size\"\r\n                  size={1}\r\n                  value={this.state.config.fontSize}\r\n                  onChange={(e) => this.onValueChange(\"fontSize\", isNaN(+e.target.value) ? this.state.config.fontSize : +e.target.value)} />\r\n\r\n                <select className=\"config-input-text\"\r\n                  value={this.state.config.fontWeight}\r\n                  onChange={(e) => this.onValueChange(\"fontWeight\", +e.target.value)}>\r\n                  <option value=\"100\">Thin</option>\r\n                  <option value=\"200\">Light</option>\r\n                  <option value=\"300\">Semilight</option>\r\n                  <option value=\"400\">Regular</option>\r\n                  <option value=\"500\">Semibold</option>\r\n                  <option value=\"600\">Bold</option>\r\n                  <option value=\"700\">Extra Bold</option>\r\n                  <option value=\"800\">Black</option>\r\n                  <option value=\"900\">Ultra Black</option>\r\n                </select>\r\n\r\n                <input type=\"color\"\r\n                  className=\"config-input-text\"\r\n                  size={1}\r\n                  value={this.state.config.fontColor}\r\n                  onChange={(e) => this.onValueChange(\"fontColor\", e.target.value)} />\r\n              </div>\r\n\r\n              <label className=\"form-group-label\">\r\n                Ignored users (one per line)\r\n              </label>\r\n              <div className=\"form-group\">\r\n                <textarea className=\"config-input-text\"\r\n                  value={this.state.config.blockedUsers.join('\\n')}\r\n                  onChange={(e) => this.onValueChange(\"blockedUsers\", e.target.value.split('\\n'))} />\r\n              </div>\r\n\r\n              <div className=\"form-group\">\r\n                <Checkbox label=\"Show badges\" value={this.state.config.showBadges} onChange={(e) => this.onValueChange(\"showBadges\", e.target.checked)} />\r\n                <Checkbox label=\"Show pronouns\" value={this.state.config.showPronouns} onChange={(e) => this.onValueChange(\"showPronouns\", e.target.checked)} />\r\n                <Checkbox label=\"Show user colours\" value={this.state.config.showUserColours} onChange={(e) => this.onValueChange(\"showUserColours\", e.target.checked)} />\r\n\r\n                {\r\n                  this.state.config.showUserColours ?\r\n                    <Checkbox label=\"Readable colours\" value={this.state.config.readableColours} onChange={(e) => this.onValueChange(\"readableColours\", e.target.checked)} /> : null\r\n                }\r\n\r\n                <Checkbox label=\"Hide commands\" value={this.state.config.hideCommands} onChange={(e) => this.onValueChange(\"hideCommands\", e.target.checked)} />\r\n                <Checkbox label=\"Drop shadow\" value={this.state.config.dropShadow} onChange={(e) => this.onValueChange(\"dropShadow\", e.target.checked)} />\r\n                <Checkbox label=\"Outline\" value={this.state.config.outline} onChange={(e) => this.onValueChange(\"outline\", e.target.checked)} />\r\n              </div>\r\n\r\n\r\n              {this.state.config.showUserColours && this.state.config.readableColours ? (\r\n                <>\r\n                  <h4 style={{ margin: \"1em 0.2em -0.5em 0.2em\" }}>Readable Colour Options</h4>\r\n\r\n\r\n                  <div className=\"form-group\">\r\n                    <label className=\"form-label\">\r\n                      Target Contrast\r\n                      <input type=\"range\"\r\n                        min={0}\r\n                        max={10}\r\n                        step={0.5}\r\n                        value={this.state.config.readableContrast} \r\n                        onChange={(e) => this.onValueChange(\"readableContrast\", +e.target.value)}/>\r\n                    </label>\r\n\r\n                    <label className=\"form-label\">\r\n                      Background Colour\r\n                      <input type=\"color\"\r\n                        className=\"config-input-text\"\r\n                        size={1}\r\n                        value={this.state.config.readableBackground}\r\n                        onChange={(e) => this.onValueChange(\"readableBackground\", e.target.value)} />\r\n                    </label>\r\n\r\n                    <label className=\"form-label\">\r\n                      Adjustment Mode\r\n\r\n                      <select className=\"config-input-text\"\r\n                        value={this.state.config.readableMode}\r\n                        onChange={(e) => this.onValueChange(\"readableMode\", +e.target.value)}>\r\n                        <option value=\"1\">HSL Luma (FFZ Default)</option>\r\n                        <option value=\"2\">Luv Luma</option>\r\n                        <option value=\"3\">HSL Loop (BTTV-like)</option>\r\n                        <option value=\"4\">RGB Loop</option>\r\n                      </select>\r\n                    </label>\r\n                  </div>\r\n                </>\r\n              ) : null}\r\n\r\n              {this.state.config.dropShadow ? (\r\n                <>\r\n                  <h4 style={{ margin: \"1em 0.2em -0.5em 0.2em\" }}>Shadow Options</h4>\r\n\r\n                  <div className=\"form-group\">\r\n                    <label className=\"form-label\">\r\n                      Offset\r\n                      <input type=\"text\"\r\n                        className=\"config-input-text\"\r\n                        placeholder=\"Shadow Offset\"\r\n                        size={1}\r\n                        value={this.state.config.dropShadowOffset}\r\n                        onChange={(e) => this.onValueChange(\"dropShadowOffset\", isNaN(+e.target.value) ? this.state.config.dropShadowOffset : +e.target.value)} />\r\n                    </label>\r\n\r\n                    <label className=\"form-label\">\r\n                      Blur Radius\r\n                      <input type=\"text\"\r\n                        className=\"config-input-text\"\r\n                        placeholder=\"Shadow Blur Radius\"\r\n                        size={1}\r\n                        value={this.state.config.dropShadowBlur}\r\n                        onChange={(e) => this.onValueChange(\"dropShadowBlur\", isNaN(+e.target.value) ? this.state.config.dropShadowBlur : +e.target.value)} />\r\n                    </label>\r\n\r\n                    <label className=\"form-label\">\r\n                      Colour\r\n                      <input type=\"color\"\r\n                        className=\"config-input-text\"\r\n                        size={1}\r\n                        value={this.state.config.dropShadowColour}\r\n                        onChange={(e) => this.onValueChange(\"dropShadowColour\", e.target.value)} />\r\n                    </label>\r\n                  </div>\r\n                </>\r\n              ) : null}\r\n\r\n\r\n              {this.state.config.outline ? (\r\n                <>\r\n                  <h4 style={{ margin: \"1em 0.2em -0.5em 0.2em\" }}>Outline Options</h4>\r\n\r\n                  <div className=\"form-group\">\r\n                    <label className=\"form-label\">\r\n                      Thickness\r\n                      <input type=\"text\"\r\n                        className=\"config-input-text\"\r\n                        placeholder=\"Outline Thickness\"\r\n                        size={1}\r\n                        value={this.state.config.outlineThickness}\r\n                        onChange={(e) => this.onValueChange(\"outlineThickness\", isNaN(+e.target.value) ? this.state.config.outlineThickness : +e.target.value)} />\r\n                    </label>\r\n\r\n                    <label className=\"form-label\">\r\n                      Colour\r\n                      <input type=\"color\"\r\n                        className=\"config-input-text\"\r\n                        size={1}\r\n                        value={this.state.config.outlineColour}\r\n                        onChange={(e) => this.onValueChange(\"outlineColour\", e.target.value)} />\r\n                    </label>\r\n                  </div>\r\n                </>\r\n              ) : null}\r\n            </form>\r\n\r\n            <div className=\"config-footer\">\r\n              <p>Paste this into a browser source!</p>\r\n              <input className=\"config-input-text\" readOnly={true} value={`${window.location.href}#${configString}`} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"config-example\">\r\n          <Chat {...this.state.chatConfig!} />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\nimport './index.css';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n","\r\nexport enum ColorAdjustmentMode {\r\n    none,\r\n    hslLuma,\r\n    luv,\r\n    hslLoop,\r\n    rgbLoop\r\n}\r\n","import { ColorAdjustmentMode } from \"./ColorAdjustmentMode\";\r\nimport { Configuration } from \"./Types\";\r\n\r\nexport const TwitchDefaultColors = [\"#FF0000\", \"#0000FF\", \"#008000\", \"#B22222\", \"#FF7F50\", \"#9ACD32\", \"#FF4500\", \"#2E8B57\", \"#DAA520\", \"#D2691E\", \"#5F9EA0\", \"#1E90FF\", \"#FF69B4\", \"#8A2BE2\", \"#00FF7F\"];\r\nexport const DefaultConfig : Configuration = {\r\n    channelName: \"\",\r\n    fontName: \"Segoe UI\",\r\n    fontSize: 15,\r\n    fontWeight: 400,\r\n    fontColor: \"#FFFFFF\",\r\n    showBadges: true,\r\n    showPronouns: true,\r\n    showUserColours: true,\r\n\r\n    dropShadow: true,\r\n    dropShadowBlur: 1,\r\n    dropShadowOffset: 1,\r\n    dropShadowColour: \"#000000\",\r\n\r\n    outline: false,\r\n    outlineThickness: 1,\r\n    outlineColour: \"#000000\",\r\n\r\n    readableColours: true,\r\n    readableBackground: \"#212121\",\r\n    readableContrast: 4.5,\r\n    readableMode: ColorAdjustmentMode.hslLuma,\r\n\r\n    hideCommands: true,\r\n    blockedUsers: ['streamelements', 'streamlabs', 'nightbot', 'moobot', 'fossabot']\r\n  }"],"sourceRoot":""}